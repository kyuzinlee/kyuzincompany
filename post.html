<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ë³´ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            padding-top: 60px;
        }
        .post-container {
            width: 60%;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            text-align: left;
            padding-bottom: 40px; /* ìˆ«ìë¥¼ ëŠ˜ë¦¬ë©´ í•˜ë‹¨ ë°°ê²½ì´ ë” ê¸¸ì–´ì§ */
        }

        h1 {
            text-align: center;
        }
        .info {
            font-size: 14px;
            color: gray;
        }
        
        /* âœ… ê¸€ ë‚´ìš©ê³¼ ëŒ“ê¸€ ì œëª© ì‚¬ì´ ê°„ê²© ì¡°ì • */
        /* âœ… ê¸€ ë‚´ìš©ê³¼ ëŒ“ê¸€ ì œëª© ì‚¬ì´ ê°„ê²© ì¡°ì • */
#post-content {
    margin-bottom: 50px; /* ìˆ«ìë¥¼ ëŠ˜ë¦¬ë©´ ë” ë„“ì–´ì§ */
}

/* âœ… ëŒ“ê¸€ ì œëª©('ëŒ“ê¸€')ê³¼ ì²« ë²ˆì§¸ ëŒ“ê¸€ ì‚¬ì´ ê°„ê²© ì¡°ì • */
h3 {
    margin-bottom: -15px; /* ê¸°ì¡´ 100px â†’ -20pxìœ¼ë¡œ ì¤„ì—¬ì„œ ê°„ê²© ì¡°ì • */
}

/* âœ… ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ì˜ ìœ„ìª½ ë§ˆì§„ ì¤„ì´ê¸° */
#comments-container {
    margin-top: 10px; /* ê¸°ì¡´ 20pxì—ì„œ ì¤„ì—¬ì„œ ëŒ“ê¸€ì´ ìœ„ë¡œ ë‹¹ê²¨ì§ */
}

    
        .comment-container {
            display: flex;
            align-items: center; /* âœ… ëŒ“ê¸€ê³¼ ë²„íŠ¼ì„ ê°™ì€ ë†’ì´ë¡œ ì •ë ¬ */
            justify-content: space-between;
            margin-top: px; /* âœ… ëŒ“ê¸€ê³¼ ë²„íŠ¼ ìœ„ì•„ë˜ ê°„ê²© ì¡°ì • */
            padding: 1px 0; /* âœ… ëŒ“ê¸€ ê°„ ê°„ê²©ì„ ì¡°ì •í•˜ë©´ì„œ ë²„íŠ¼ë„ ë™ì¼ ì ìš© */
        }
    
        .comment-buttons {
    display: flex; /* âœ… ê°€ë¡œ ì •ë ¬ ìœ ì§€ */
    gap: 8px; /* âœ… ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ê°„ ê°„ê²© ì¡°ì • */
}

.comment-buttons button {
    cursor: pointer; /* âœ… ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ì†ê°€ë½ ëª¨ì–‘ìœ¼ë¡œ ë³€ê²½ */
    background-color: #007bff; /* âœ… ê¸°ë³¸ ë°°ê²½ìƒ‰ (íŒŒë€ìƒ‰ - ìˆ˜ì • ë²„íŠ¼) */
    color: white; /* âœ… ê¸€ììƒ‰ */
    border: none; /* âœ… í…Œë‘ë¦¬ ì—†ì• ê¸° */
    padding: 6px 10px; /* âœ… ë²„íŠ¼ ë‚´ë¶€ ì—¬ë°± */
    border-radius: 5px; /* âœ… ë²„íŠ¼ ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
}

.comment-buttons button:nth-child(2) { 
    background-color: #dc3545; /* âœ… ì‚­ì œ ë²„íŠ¼ì€ ë¹¨ê°„ìƒ‰ */
}


        .comment-buttons button {
    cursor: pointer; /* âœ… ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ì†ê°€ë½ ëª¨ì–‘ìœ¼ë¡œ ë³€ê²½ */
}

        #add-comment-btn {
    position: absolute;
    right: 00px; /* ìˆ«ìë¥¼ ì¡°ì •í•˜ì—¬ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™ */
    margin-top: 0px; /* í•„ìš”í•˜ë©´ ìœ„ì•„ë˜ ìœ„ì¹˜ë„ ì¡°ì • ê°€ëŠ¥ */
}

@media (max-width: 768px) {
    /* ì…ë ¥ í¼ì´ ëª¨ë°”ì¼ì—ì„œë„ ì •ë ¬ë˜ë„ë¡ */
    .form-container {
        width: 95%;
        padding: 15px;
    }

    input, textarea {
        width: 100%; /* ì…ë ¥ í•„ë“œ ë„ˆë¹„ ì¡°ì • */
    }

    button {
        width: 100%; /* ë²„íŠ¼ ë„ˆë¹„ ì¡°ì • */
        padding: 10px;
        font-size: 14px;
    }

    /* ğŸ“Œ ê²Œì‹œíŒ ë°˜ì‘í˜• (ëª©ë¡ ë° ë²„íŠ¼ ì •ë ¬) */
    body {
        padding-top: 50px; /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ì—¬ë°± ì¡°ì • */
    }

    .post-container, table {
        width: 95%; /* ëª¨ë°”ì¼ì—ì„œëŠ” ì „ì²´ ë„ˆë¹„ì— ê°€ê¹ê²Œ */
    }

    th, td {
        padding: 8px; /* ê¸€ìê°€ ë„ˆë¬´ ë¶™ì§€ ì•Šë„ë¡ ì¡°ì • */
        font-size: 14px; /* í°íŠ¸ í¬ê¸° ì¤„ì´ê¸° */
    }

    .write-btn {
        position: static; /* ë²„íŠ¼ì„ ìš°ì¸¡ ê³ ì •í•˜ì§€ ì•Šê³  ê¸°ë³¸ íë¦„ëŒ€ë¡œ ë°°ì¹˜ */
        display: block;
        width: 90%; /* ë„ˆë¹„ë¥¼ ë„“í˜€ì„œ ê°€ìš´ë° ì •ë ¬ */
        margin: 10px auto; /* ìƒí•˜ ì—¬ë°± ì¶”ê°€ ë° ì¤‘ì•™ ì •ë ¬ */
    }

    /* ğŸ“Œ ëŒ“ê¸€ ì˜ì—­ ë°˜ì‘í˜• */
    .comment-container {
        flex-direction: column; /* ëŒ“ê¸€ê³¼ ë²„íŠ¼ì„ ì„¸ë¡œ ì •ë ¬ */
        align-items: flex-start; /* ì™¼ìª½ ì •ë ¬ */
    }

    .comment-buttons {
        margin-top: 5px; /* ë²„íŠ¼ê³¼ ëŒ“ê¸€ ì‚¬ì´ ê°„ê²© */
    }
}


    </style>
    
</head>
<body>
    <nav style="background-color: #333; padding: 10px; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;">
        <a href="index.html" style="color: white; margin: 10px;">í™ˆ</a>
        <a href="board.html" style="color: white; margin: 10px;">ë¬¸ì˜ ê²Œì‹œíŒ</a>
    </nav>

    <style>
        body {
            padding-top: 60px;
        }
    </style>

    <h1>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</h1>
    <div id="post-container" class="post-container">
        <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, deleteDoc, collection, addDoc, 
    query, where, getDocs } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";



        const firebaseConfig = {
            apiKey: "AIzaSyDF45mwwX5ohDpUCSmQL59ZMF9X9dIV0OU",
            authDomain: "qnaboard-d1c16.firebaseapp.com",
            projectId: "qnaboard-d1c16",
            storageBucket: "qnaboard-d1c16.appspot.com",
            messagingSenderId: "400425836323",
            appId: "1:400425836323:web:f9c9c11832e1447cc03696"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const params = new URLSearchParams(window.location.search);
        const postId = params.get("id");

        const postContainer = document.getElementById("post-container");

        if (!postId) {
            postContainer.innerHTML = "<p>ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.</p>";
        } else {
            loadPost(postId);
        }

        async function loadPost(id) {
            const docRef = doc(db, "posts", id);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const post = docSnap.data();
                const postTime = post.timestamp?.toDate().toLocaleString() || "ì‹œê°„ ì •ë³´ ì—†ìŒ";

                postContainer.innerHTML = `
                    <div style="position: relative;">
                        <h2 id="post-title">${post.title}</h2>
                        <p class="info">ì‘ì„±ì: ${post.author} | ì‘ì„±ì¼: ${postTime}</p>
                        <hr>
                        <p id="post-content">${post.content}</p>

                        

<!-- ëŒ“ê¸€ ëª©ë¡ (ìœ„ìª½ìœ¼ë¡œ ì´ë™) -->
<h3>ëŒ“ê¸€</h3>
<div id="comments-container" style="margin-top: 20px;">
    <p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
</div>

<!-- ëŒ“ê¸€ ì…ë ¥ì°½ (ì•„ë˜ë¡œ ì´ë™) -->
<input type="text" id="comment-author" placeholder="ì‘ì„±ì ì…ë ¥" style="width: 15%; padding: 5px; margin-top: 20px;">
<input type="password" id="comment-password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="width: 15%; padding: 5px;">
<textarea id="comment-content" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; height: 60px; padding: 5px; margin-top: 5px;"></textarea>
<button id="add-comment-btn" style="background: green; color: white; padding: 6px 12px; border: none; cursor: pointer; font-size: 14px; border-radius: 5px;">
    ëŒ“ê¸€ ë“±ë¡
</button>


<button id="edit-btn" style="display:block; background:green; color:white; padding:6px 12px; border:none;
    cursor:pointer; font-size:14px; border-radius:5px; position: absolute; top: 45px; right: 50px; margin-right: 1%;">
    ìˆ˜ì •
</button>

<button id="delete-btn" style="display:block; background:red; color:white; padding:6px 12px; border:none;
    cursor:pointer; font-size:14px; border-radius:5px; position: absolute; top: 45px; right: 00px;">
    ì‚­ì œ
</button>


                       <button id="save-btn" style="display:none; background:blue; color:white; padding:6px 12px; border:none;
cursor:pointer; font-size:14px; border-radius:5px; position: absolute; top: 45px; right: 00px;">
ì €ì¥
</button>

                    </div>
                `;

                document.getElementById("delete-btn").onclick = () => deletePost(id, post.password);
                document.getElementById("edit-btn").onclick = () => editPost(id, post.password);
                document.getElementById("add-comment-btn").onclick = () => addComment(id);
loadComments(id); // âœ… ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ í˜¸ì¶œ

async function addComment(postId) {
    const author = document.getElementById("comment-author").value.trim();
    const password = document.getElementById("comment-password").value.trim();
    const content = document.getElementById("comment-content").value.trim();

    if (!author || !password || !content) {
        alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }

    await addDoc(collection(db, "comments"), {
        postId: postId,
        author: author,
        password: password,
        content: content,
        timestamp: new Date()
    });

    alert("ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
    loadComments(postId);
}

async function deleteComment(commentId) {
    const userPassword = prompt("ëŒ“ê¸€ ì‚­ì œë¥¼ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
    if (!userPassword) return;

    const commentRef = doc(db, "comments", commentId);
    const commentSnap = await getDoc(commentRef);

    if (!commentSnap.exists()) {
        alert("ëŒ“ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    const commentData = commentSnap.data();
    if (commentData.password !== userPassword) {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
        return;
    }

    await deleteDoc(commentRef);
    alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
    loadComments(commentData.postId);
}

window.deleteComment = deleteComment;


async function editComment(commentId) {
    const userPassword = prompt("ëŒ“ê¸€ ìˆ˜ì •ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
    if (!userPassword) return;

    const commentRef = doc(db, "comments", commentId);
    const commentSnap = await getDoc(commentRef);

    if (!commentSnap.exists()) {
        alert("ëŒ“ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    const commentData = commentSnap.data();
    if (commentData.password !== userPassword) {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
        return;
    }

    const newContent = prompt("ìƒˆë¡œìš´ ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:", commentData.content);
    if (!newContent) return;

    await updateDoc(commentRef, { content: newContent });
    alert("ëŒ“ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
    loadComments(commentData.postId);
}

window.editComment = editComment;



async function loadComments(postId) {
    console.log(`ğŸ” loadComments ì‹¤í–‰ë¨ (postId: ${postId})`);

    const commentsContainer = document.getElementById("comments-container");
    commentsContainer.innerHTML = "<p>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";

    const commentsRef = collection(db, "comments");
    const q = query(commentsRef, where("postId", "==", postId));
    const querySnapshot = await getDocs(q);

    let commentsHTML = "";
    querySnapshot.forEach((commentDoc) => {
    const comment = commentDoc.data();
    commentsHTML += `<div class="comment-container">
        <div>
            <strong>ğŸ’¬ ${comment.author}</strong>: ${comment.content}
        </div>
        <div class="comment-buttons">
            <button onclick="editComment('${commentDoc.id}')">ìˆ˜ì •</button>
            <button onclick="deleteComment('${commentDoc.id}')">ì‚­ì œ</button>
        </div>
    </div>`;
});

    commentsContainer.innerHTML = commentsHTML || "<p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
}


            } else {
                postContainer.innerHTML = "<p>ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
            }
        }

        function editPost(id, correctPassword) {
            const userPassword = prompt("ê²Œì‹œê¸€ ìˆ˜ì •ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");

            if (userPassword !== correctPassword) {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
                return;
            }

            document.getElementById("edit-btn").style.display = "none";
            document.getElementById("delete-btn").style.display = "none";
            document.getElementById("save-btn").style.display = "inline-block";

            const titleElement = document.getElementById("post-title");
            const contentElement = document.getElementById("post-content");

            titleElement.outerHTML = `<input type="text" id="edit-title" value="${titleElement.innerText}" 
                style="width: 100%; padding: 5px; font-size: 18px; font-weight: bold;">`;

            contentElement.outerHTML = `<textarea id="edit-content" style="width: 100%; height: 150px; padding: 5px;">${contentElement.innerText}</textarea>`;

            document.getElementById("save-btn").onclick = () => savePost(id);
        }

        async function savePost(id) {
            const newTitle = document.getElementById("edit-title").value.trim();
            const newContent = document.getElementById("edit-content").value.trim();

            if (!newTitle || !newContent) {
                alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
                return;
            }

            const docRef = doc(db, "posts", id);

            try {
                await updateDoc(docRef, {
                    title: newTitle,
                    content: newContent,
                });

                alert("ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.reload();
            } catch (error) {
                console.error("ê²Œì‹œê¸€ ìˆ˜ì • ì˜¤ë¥˜:", error);
                alert("ê²Œì‹œê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

        async function deletePost(id, correctPassword) {
            const userPassword = prompt("ê²Œì‹œê¸€ ì‚­ì œë¥¼ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");

            if (!userPassword) return;

            if (userPassword === correctPassword) {
                if (confirm("ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    await deleteDoc(doc(db, "posts", id));
                    alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    window.location.href = "board.html";
                }
            } else {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤! ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        }
    </script>
</body>
</html>
